<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sala de Leitura | JOÃO VITTA</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- Firebase SDKs (import via ES Modules) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC72gBi7POz-NqEMWKgu54S9vTyr0oFkzs",
    authDomain: "cadsl-3ef8f.firebaseapp.com",
    projectId: "cadsl-3ef8f",
    storageBucket: "cadsl-3ef8f.appspot.com",
    messagingSenderId: "556775341028",
    appId: "1:556775341028:web:c7c76dd36e7f17411925f1"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Expõe funções e variáveis para uso global
  window.firebaseApp = app;
  window.auth = auth;
  window.db = db;
  window.firebaseFns = { onAuthStateChanged, signInWithEmailAndPassword, signOut, collection, addDoc, onSnapshot, deleteDoc, doc };
</script>

<!-- jsPDF via script normal -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<!-- Tesseract OCR -->
<script src="https://unpkg.com/tesseract.js@v5.0.0/dist/tesseract.min.js"></script>

<style>
  /* Cores vibrantes estilo material */
  :root {
    --primary: #1e88e5;
    --primary-dark: #1565c0;
    --secondary: #ff7043;
    --background: #f3f6f9;
    --text-primary: #222;
    --text-light: #fff;
  }
  * {
    box-sizing: border-box;
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  body {
    background: var(--background);
    color: var(--text-primary);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  header {
    background-color: var(--primary);
    color: var(--text-light);
    padding: 20px;
    box-shadow: 0 3px 7px rgba(0,0,0,0.2);
  }
  header h1 {
    font-weight: 700;
    font-size: 1.8rem;
    display: flex; align-items: center; gap: 10px;
  }
  header h1 i {
    color: var(--secondary);
  }
  nav {
    margin-top: 15px;
    display: flex;
    gap: 15px;
  }
  nav button {
    background: transparent;
    border: none;
    color: var(--text-light);
    font-weight: 600;
    cursor: pointer;
    padding: 8px 16px;
    border-radius: 25px;
    transition: background-color 0.3s ease;
    font-size: 1rem;
  }
  nav button.active,
  nav button:hover {
    background-color: var(--primary-dark);
  }

  main.container {
    flex-grow: 1;
    max-width: 1000px;
    margin: 30px auto;
    padding: 0 20px 40px;
  }
  .card {
    background: white;
    border-radius: 12px;
    padding: 25px 30px;
    box-shadow: 0 4px 12px rgb(30 136 229 / 0.15);
    margin-bottom: 30px;
  }
  h2 {
    margin-bottom: 20px;
    color: var(--primary-dark);
  }
  form .form-group {
    margin-bottom: 18px;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
    color: var(--primary-dark);
  }
  input[type="text"],
  input[type="number"],
  input[type="email"],
  input[type="password"],
  select,
  input[type="file"] {
    width: 100%;
    padding: 10px 12px;
    font-size: 1rem;
    border: 2px solid var(--primary);
    border-radius: 8px;
    transition: border-color 0.3s ease;
  }
  input:focus, select:focus {
    outline: none;
    border-color: var(--secondary);
  }
  .btn {
    cursor: pointer;
    font-weight: 700;
    border-radius: 25px;
    padding: 10px 24px;
    font-size: 1rem;
    border: none;
    transition: background-color 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .btn-primary {
    background-color: var(--primary);
    color: var(--text-light);
  }
  .btn-primary:hover {
    background-color: var(--primary-dark);
  }
  .btn-secondary {
    background-color: var(--secondary);
    color: var(--text-light);
  }
  .btn-secondary:hover {
    background-color: #e64a19;
  }
  .btn-warning {
    background-color: #ffa726;
    color: #222;
  }
  .btn-warning:hover {
    background-color: #fb8c00;
  }
  .flex-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  .flex-1 {
    flex: 1;
    min-width: 200px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    text-align: left;
    padding: 10px 15px;
    border-bottom: 1px solid #ddd;
    font-size: 0.95rem;
  }
  th {
    background-color: var(--primary);
    color: var(--text-light);
  }
  tr:hover {
    background-color: var(--background);
  }
  .book-cover {
    width: 70px;
    height: 90px;
    object-fit: cover;
    border-radius: 6px;
  }
  .status-available {
    background-color: #dcedc8;
    color: #558b2f;
    padding: 5px 10px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.85rem;
  }
  .status-loaned {
    background-color: #ffe0b2;
    color: #ef6c00;
    padding: 5px 10px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.85rem;
  }
  /* Search input and button */
  .search-container {
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
  }
  .search-container input {
    flex-grow: 1;
  }
  /* Responsive */
  @media (max-width: 600px) {
    nav {
      flex-direction: column;
      gap: 10px;
    }
    .flex-row {
      flex-direction: column;
    }
  }
  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .modal.active {
    display: flex;
  }
  .modal-content {
    background: white;
    border-radius: 12px;
    padding: 20px 25px;
    max-width: 450px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
  }
  .modal-close {
    position: absolute;
    top: 12px;
    right: 12px;
    border: none;
    background: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--primary-dark);
  }
  .modal h3 {
    margin-bottom: 18px;
  }
</style>
</head>
<body>

<!-- Login Screen -->
<div id="login-screen" style="min-height: 100vh; display:flex; justify-content:center; align-items:center; background: var(--background);">
  <div style="background: white; padding: 30px 40px; border-radius: 14px; box-shadow: 0 8px 20px rgb(30 136 229 / 0.15); max-width: 360px; width: 90%; text-align:center;">
    <h2 style="margin-bottom:15px; color: var(--primary);"><i class="fas fa-book"></i> Sala de Leitura</h2>
    <input id="email" type="email" placeholder="E-mail" style="width: 100%; padding:12px; margin-bottom:15px; border: 2px solid var(--primary); border-radius: 8px; font-size: 1rem;" />
    <input id="password" type="password" placeholder="Senha" style="width: 100%; padding:12px; margin-bottom:20px; border: 2px solid var(--primary); border-radius: 8px; font-size: 1rem;" />
    <button id="loginBtn" class="btn btn-primary" style="width: 100%; font-weight: 700; font-size: 1.1rem;">Entrar</button>
  </div>
</div>

<!-- Main App -->
<div id="main-app" style="display:none; flex-direction: column; min-height: 100vh;">
<header>
  <div class="container">
    <h1><i class="fas fa-book"></i> Sala de Leitura | JOÃO VITTA</h1>
    <nav>
      <button class="active" data-tab="tab-books">Livros</button>
      <button data-tab="tab-reports">Relatórios</button>
      <button id="logoutBtn" style="margin-left:auto; background:transparent; border:none; color:#fff; font-weight:600; cursor:pointer;">Sair <i class="fas fa-sign-out-alt"></i></button>
    </nav>
  </div>
</header>

<main class="container">

  <!-- Livros -->
  <section id="tab-books" class="tab-content" style="display: block;">
    <div class="card">
      <h2><i class="fas fa-book"></i> Cadastrar Novo Livro</h2>
      <form id="bookForm">
        <div class="flex-row">
          <div class="form-group flex-1">
            <label for="title">Título</label>
            <input id="title" type="text" required />
          </div>
          <div class="form-group flex-1">
            <label for="author">Autor</label>
            <input id="author" type="text" required />
          </div>
        </div>

        <div class="flex-row">
          <div class="form-group flex-1">
            <label for="genre">Gênero</label>
            <select id="genre" required>
              <option value="" disabled selected>Selecione...</option>
              <option>Romance</option>
              <option>Ficção Científica</option>
              <option>Fantasia</option>
              <option>Terror</option>
              <option>Mistério</option>
              <option>Suspense</option>
              <option>Aventura</option>
              <option>Ficção Histórica</option>
              <option>Literatura Infantil</option>
              <option>Juvenil</option>
              <option>Realismo Mágico</option>
              <option>Poesia</option>
              <option>Teatro</option>
              <option>Contos</option>
              <option>Crônicas</option>
              <option>Graphic Novel</option>
              <option>Biografia</option>
              <option>Autobiografia</option>
              <option>Ensaios</option>
              <option>História</option>
              <option>Ciência</option>
              <option>Autoajuda</option>
              <option>Desenvolvimento Pessoal</option>
              <option>Educação</option>
              <option>Negócios</option>
              <option>Economia</option>
              <option>Tecnologia</option>
              <option>Programação</option>
              <option>Saúde</option>
              <option>Bem-Estar</option>
              <option>Psicologia</option>
              <option>Religião</option>
              <option>Espiritualidade</option>
              <option>Arte</option>
              <option>Cultura</option>
              <option>Música</option>
              <option>Cinema</option>
              <option>Fotografia</option>
              <option>Viagem</option>
              <option>Culinária</option>
              <option>Direito</option>
              <option>Política</option>
              <option>Manuais Técnicos</option>
              <option>Dicionários</option>
              <option>Enciclopédias</option>
              <option>Livros de Colorir</option>
              <option>Planners</option>
              <option>Livros Interativos</option>
             
            </select>
          </div>
          <div class="form-group flex-1">
            <label for="publisher">Editora</label>
            <input id="publisher" type="text" required />
          </div>
        </div>

        <div class="flex-row">
          <div class="form-group flex-1">
            <label for="year">Ano</label>
            <input id="year" type="number" min="1900" max="2099" required />
          </div>
          <div class="form-group flex-1">
            <label for="copies">Exemplares</label>
            <input id="copies" type="number" min="1" required />
          </div>
        </div>

        <div class="form-group">
          <label for="cover">Capa do Livro (imagem)</label>
          <input id="cover" type="file" accept="image/*" />
          <div id="coverPreview" style="margin-top: 10px;"></div>
        </div>

        <div class="flex-row" style="gap: 15px;">
          <button type="button" class="btn btn-secondary" id="extractFromImage"><i class="fas fa-image"></i> Preencher com Imagem (OCR)</button>
          <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salvar Livro</button>
          <button type="button" class="btn btn-warning" id="clearFormBtn"><i class="fas fa-eraser"></i> Limpar Formulário</button>
        </div>
      </form>
    </div>

    <div class="card">
      <h2><i class="fas fa-list"></i> Lista de Livros</h2>
      <div class="search-container">
        <input type="text" id="searchBooks" placeholder="Buscar por título ou autor..." />
        <button class="btn btn-primary" id="searchBtn"><i class="fas fa-search"></i> Buscar</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Capa</th>
            <th>Título</th>
            <th>Autor</th>
            <th>Gênero</th>
            <th>Editora</th>
            <th>Ano</th>
            <th>Exemplares</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody id="booksList"></tbody>
      </table>
    </div>
  </section>

  <!-- Relatórios -->
  <section id="tab-reports" class="tab-content" style="display:none;">
    <div class="card">
      <h2><i class="fas fa-chart-bar"></i> Relatórios</h2>
      <p>Relatórios gerenciais básicos</p>
      <div style="display:flex; gap: 25px; margin-top: 20px; flex-wrap: wrap;">
        <div style="background: #81c784; color:#1b5e20; padding: 20px 25px; border-radius: 12px; flex: 1; min-width: 150px; text-align: center;">
          <h3 id="totalBooksCount" style="font-size: 2rem; margin-bottom: 5px;">0</h3>
          <p>Livros cadastrados</p>
        </div>
        <div style="background: #4fc3f7; color:#01579b; padding: 20px 25px; border-radius: 12px; flex: 1; min-width: 150px; text-align: center;">
          <h3 id="totalCopiesCount" style="font-size: 2rem; margin-bottom: 5px;">0</h3>
          <p>Exemplares totais</p>
        </div>
      </div>
      <div style="margin-top: 25px;">
        <button class="btn btn-primary" id="exportPdfBtn"><i class="fas fa-file-pdf"></i> Exportar PDF</button>
        <button class="btn btn-secondary" id="exportCsvBtn"><i class="fas fa-file-csv"></i> Exportar CSV</button>
      </div>
    </div>
  </section>
</main>
</div>

<script>
  // Aguarda que o módulo Firebase tenha carregado e exposto na window
  document.addEventListener('DOMContentLoaded', () => {
    const {
      auth,
      db,
      firebaseFns: { onAuthStateChanged, signInWithEmailAndPassword, signOut, collection, addDoc, onSnapshot, deleteDoc, doc }
    } = window;

    const loginScreen = document.getElementById('login-screen');
    const mainApp = document.getElementById('main-app');

    const loginBtn = document.getElementById('loginBtn');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const logoutBtn = document.getElementById('logoutBtn');

    const bookForm = document.getElementById('bookForm');
    const titleInput = document.getElementById('title');
    const authorInput = document.getElementById('author');
    const genreSelect = document.getElementById('genre');
    const publisherInput = document.getElementById('publisher');
    const yearInput = document.getElementById('year');
    const copiesInput = document.getElementById('copies');
    const coverInput = document.getElementById('cover');
    const coverPreview = document.getElementById('coverPreview');

    const extractFromImageBtn = document.getElementById('extractFromImage');
    const clearFormBtn = document.getElementById('clearFormBtn');

    const booksList = document.getElementById('booksList');

    const tabsButtons = document.querySelectorAll('nav button[data-tab]');
    const tabsSections = document.querySelectorAll('.tab-content');

    const searchInput = document.getElementById('searchBooks');
    const searchBtn = document.getElementById('searchBtn');

    const exportPdfBtn = document.getElementById('exportPdfBtn');
    const exportCsvBtn = document.getElementById('exportCsvBtn');

    // Variáveis para dados
    let currentUser = null;
    let booksData = [];

    // UI funções
    function switchTab(tabName) {
      tabsButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tabName));
      tabsSections.forEach(section => section.style.display = (section.id === tabName ? 'block' : 'none'));
    }

    tabsButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        switchTab(btn.dataset.tab);
      });
    });

    // Login handler
    loginBtn.addEventListener('click', async () => {
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();
      if (!email || !password) {
        alert('Preencha e-mail e senha');
        return;
      }
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (err) {
        alert('Erro no login: ' + err.message);
      }
    });

    logoutBtn.addEventListener('click', async () => {
      await signOut(auth);
    });

    onAuthStateChanged(auth, user => {
      currentUser = user;
      if (user) {
        loginScreen.style.display = 'none';
        mainApp.style.display = 'flex';
        switchTab('tab-books');
        loadBooksRealtime();
      } else {
        loginScreen.style.display = 'flex';
        mainApp.style.display = 'none';
        booksList.innerHTML = '';
        booksData = [];
      }
    });

    // Preview da capa
    coverInput.addEventListener('change', () => {
      const file = coverInput.files[0];
      if (!file) {
        coverPreview.innerHTML = '';
        return;
      }
      const url = URL.createObjectURL(file);
      coverPreview.innerHTML = `<img src="${url}" alt="Preview Capa" style="width:120px; height:auto; border-radius: 8px; object-fit: cover;" />`;
    });

    // Função para limpar formulário
    function clearForm() {
      bookForm.reset();
      coverPreview.innerHTML = '';
    }
    clearFormBtn.addEventListener('click', clearForm);

    // Função para salvar livro no Firestore
    async function saveBook(book) {
      try {
        await addDoc(collection(db, 'books'), book);
        alert('Livro salvo com sucesso!');
      } catch (err) {
        alert('Erro ao salvar livro: ' + err.message);
      }
    }

    // Form submit
    bookForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!titleInput.value.trim() || !authorInput.value.trim()) {
        alert('Título e Autor são obrigatórios');
        return;
      }
      if (!genreSelect.value) {
        alert('Selecione um gênero');
        return;
      }
      if (!publisherInput.value.trim() || !yearInput.value || !copiesInput.value) {
        alert('Preencha todos os campos corretamente');
        return;
      }

      // Capa: converte a imagem em base64 para salvar
      let coverBase64 = '';
      if (coverInput.files.length > 0) {
        coverBase64 = await toBase64(coverInput.files[0]);
      }

      const newBook = {
        title: titleInput.value.trim(),
        author: authorInput.value.trim(),
        genre: genreSelect.value,
        publisher: publisherInput.value.trim(),
        year: Number(yearInput.value),
        copies: Number(copiesInput.value),
        cover: coverBase64,
        createdAt: new Date()
      };

      await saveBook(newBook);
      clearForm();
    });

    // converte arquivo imagem para base64
    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
      });
    }

    // OCR para preencher título e autor da capa
    extractFromImageBtn.addEventListener('click', async () => {
      if (coverInput.files.length === 0) {
        alert('Selecione uma imagem da capa primeiro');
        return;
      }
      const file = coverInput.files[0];
      const url = URL.createObjectURL(file);

      extractFromImageBtn.disabled = true;
      extractFromImageBtn.textContent = 'Extraindo texto...';

      try {
        const { data: { text } } = await Tesseract.recognize(url, 'por', {
          logger: m => console.log(m)
        });
        // tentar extrair título e autor via heurística simples:
        // título = primeira linha, autor = segunda linha
        const lines = text.trim().split('\n').map(l => l.trim()).filter(l => l.length > 0);
        if (lines.length >= 1) titleInput.value = lines[0];
        if (lines.length >= 2) authorInput.value = lines[1];
        alert('Texto extraído da imagem! Confira e ajuste se precisar.');
      } catch (e) {
        alert('Erro ao extrair texto: ' + e.message);
      } finally {
        extractFromImageBtn.disabled = false;
        extractFromImageBtn.innerHTML = '<i class="fas fa-image"></i> Preencher com Imagem (OCR)';
      }
    });

    // Realtime Firestore snapshot para listar livros
   function loadBooksRealtime() {
  const colRef = collection(db, 'books');
  onSnapshot(colRef, (snapshot) => {
    booksData = [];
    booksList.innerHTML = '';
    snapshot.forEach(docSnap => {
      const book = { id: docSnap.id, ...docSnap.data() };
      booksData.push(book);
    });
    renderBooks(booksData);
    updateReports();
  }, (error) => {
    if (error.message.includes('Missing or insufficient permissions')) {
      Swal.fire({
        icon: 'warning',
        title: 'Desconectado',
        text: 'Você foi desconectado com sucesso.',
        confirmButtonText: 'Ok'
      }).then(() => {
        signOut(auth);
      });
    } else {
      alert('Erro ao carregar livros: ' + error.message);
    }
  });
}


    // Renderiza tabela de livros
    function renderBooks(books) {
      booksList.innerHTML = '';
      if (books.length === 0) {
        booksList.innerHTML = `<tr><td colspan="8" style="text-align:center; padding:20px; color:#999;">Nenhum livro cadastrado</td></tr>`;
        return;
      }
      for (const book of books) {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td><img src="${book.cover || 'https://via.placeholder.com/70x90?text=Sem+Capa'}" alt="Capa" class="book-cover"/></td>
          <td>${escapeHtml(book.title)}</td>
          <td>${escapeHtml(book.author)}</td>
          <td>${escapeHtml(book.genre)}</td>
          <td>${escapeHtml(book.publisher)}</td>
          <td>${book.year}</td>
          <td>${book.copies}</td>
          <td>
            <button class="btn btn-warning btn-sm btn-delete" data-id="${book.id}" title="Excluir"><i class="fas fa-trash"></i></button>
          </td>
        `;
        booksList.appendChild(tr);
      }

      // delete event
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.dataset.id;
          if (confirm('Deseja mesmo excluir este livro?')) {
            try {
              await deleteDoc(doc(db, 'books', id));
            } catch (err) {
              alert('Erro ao excluir: ' + err.message);
            }
          }
        });
      });
    }

    // Busca simples (filtra livros no client)
    searchBtn.addEventListener('click', () => {
      const term = searchInput.value.trim().toLowerCase();
      if (!term) {
        renderBooks(booksData);
        return;
      }
      const filtered = booksData.filter(b =>
        b.title.toLowerCase().includes(term) ||
        b.author.toLowerCase().includes(term)
      );
      renderBooks(filtered);
    });

    // Exportar PDF usando jsPDF + autotable
    exportPdfBtn.addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(18);
      doc.text("Relatório de Livros", 14, 22);
      doc.setFontSize(11);
      doc.setTextColor(100);

      const headers = [["Título", "Autor", "Gênero", "Editora", "Ano", "Exemplares"]];
      const data = booksData.map(b => [
        b.title,
        b.author,
        b.genre,
        b.publisher,
        b.year.toString(),
        b.copies.toString()
      ]);

      doc.autoTable({
        startY: 30,
        head: headers,
        body: data,
        styles: { fontSize: 9 },
        headStyles: { fillColor: [30, 136, 229] }
      });

      doc.save("relatorio_livros.pdf");
    });

    // Exportar CSV simples
    exportCsvBtn.addEventListener('click', () => {
      const csvRows = [];
      const headers = ["Título", "Autor", "Gênero", "Editora", "Ano", "Exemplares"];
      csvRows.push(headers.join(','));

      booksData.forEach(b => {
        const row = [
          `"${b.title.replace(/"/g, '""')}"`,
          `"${b.author.replace(/"/g, '""')}"`,
          `"${b.genre.replace(/"/g, '""')}"`,
          `"${b.publisher.replace(/"/g, '""')}"`,
          b.year,
          b.copies
        ];
        csvRows.push(row.join(','));
      });

      const csvString = csvRows.join('\n');
      const blob = new Blob([csvString], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'relatorio_livros.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // Atualiza os números nos relatórios
    function updateReports() {
      document.getElementById('totalBooksCount').textContent = booksData.length;
      const totalCopies = booksData.reduce((acc, b) => acc + (b.copies || 0), 0);
      document.getElementById('totalCopiesCount').textContent = totalCopies;
    }

    // Função de escape para segurança na inserção de texto
    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
  });
</script>

</body>
</html>
